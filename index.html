<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>What the Package Does (One Line, Title Case) • annotreer</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="What the Package Does (One Line, Title Case)">
<meta name="description" content="What the package does (one paragraph).">
<meta property="og:description" content="What the package does (one paragraph).">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">annotreer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/pruning.html">Cost Complexity Pruning</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jtr13/annotreer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="annotreer">annotreer<a class="anchor" aria-label="anchor" href="#annotreer"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>This package provides one function, <code><a href="reference/annotree.html">annotree()</a></code>, which is a wrapper for <code><a href="https://rdrr.io/pkg/rpart.plot/man/prp.html" class="external-link">rpart.plot::prp()</a></code>. By employing customized labeling functions under the hood, <code><a href="reference/annotree.html">annotree()</a></code> helps us visualize complexity parameter calculations. These annotations are helpful for explaining CART’s pruning algorithm.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"jtr13/annotreer"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Did you ever create a classification tree with <strong>rpart</strong>, view the <code>cptable</code> returned and wonder how the columns were calculated? This package creates custom label functions and then calls <code><a href="https://rdrr.io/pkg/rpart.plot/man/prp.html" class="external-link">rpart.plot::prp()</a></code> to create tree diagrams that will aid in understanding how this table summarizes the pruning options. Let’s start with an example.</p>
<p>We create a large tree with <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart::rpart()</a></code> and visualize it with <code><a href="reference/annotree.html">annotree()</a></code>. The data is from the <strong>rpart</strong> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart" class="external-link">rpart</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">kyphosis</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Kyphosis Age Number Start</span></span>
<span><span class="co">#&gt; 1   absent  71      3     5</span></span>
<span><span class="co">#&gt; 2   absent 158      3    14</span></span>
<span><span class="co">#&gt; 3  present 128      4     5</span></span>
<span><span class="co">#&gt; 4   absent   2      5     1</span></span>
<span><span class="co">#&gt; 5   absent   1      4    15</span></span>
<span><span class="co">#&gt; 6   absent   1      2    16</span></span></code></pre></div>
<p><code>Kyphosis</code> – type of deformation <code>absent</code> or <code>present</code> after surgery</p>
<p><code>Age</code> – in months</p>
<p><code>Number</code> – the number of vertebrae involved</p>
<p><code>Start</code> – the number of the first (topmost) vertebra operated on</p>
<p>The goal is to classify the <code>Kyphosis</code> variable based on <code>Age</code>, <code>Number</code> and <code>Start</code>. By setting the parameter <code>show_classes = TRUE</code> in the call to <code><a href="reference/annotree.html">annotree()</a></code> below, the nodes are labeled with class labels and class counts.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">Kyphosis</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">Number</span> <span class="op">+</span> <span class="va">Start</span>, data <span class="op">=</span> <span class="va">kyphosis</span>, cp <span class="op">=</span> <span class="fl">0</span>, minsplit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jtr13/annotreer" class="external-link">annotreer</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="va">kmod</span>, show_classes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example-1.svg" width="70%" style="display: block; margin: auto;"></p>
<p>Since we set the parameters of <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart()</a></code> to grow as large a tree as possible, the deviance for all of the leaf nodes is zero: every leaf node has a zero for one of the classes. We can make the deviance of the leaves more explict by setting <code>show_leaf_dev</code> to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="va">kmod</span>, show_classes <span class="op">=</span> <span class="cn">TRUE</span>, show_leaf_dev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.svg" width="70%" style="display: block; margin: auto;"></p>
<p>Now we turn to the pruning process. <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart()</a></code> returns a <code>cptable</code> which provides pruning options. Following the cost complexity pruning algorithm of CART (see Breiman, et al. 1984) the table does not show every possible subtree, only the ones produced by sequentially pruning the next weakest link until the tree is reduced to a single node.</p>
<p>In this particular case, we are given 6 options shown in the <code>nsplit</code> column: 0, 1, 2, 5, 10, and 16 splits. Each of the larger subtrees contains the smaller ones, as we’ll see when we get into the details of the pruning process.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmod</span><span class="op">$</span><span class="va">cptable</span></span>
<span><span class="co">#&gt;        CP nsplit rel error xerror   xstd</span></span>
<span><span class="co">#&gt; 1 0.17647      0    1.0000  1.000 0.2156</span></span>
<span><span class="co">#&gt; 2 0.11765      1    0.8235  1.118 0.2243</span></span>
<span><span class="co">#&gt; 3 0.07843      2    0.7059  1.118 0.2243</span></span>
<span><span class="co">#&gt; 4 0.05882      5    0.4706  1.118 0.2243</span></span>
<span><span class="co">#&gt; 5 0.02941     10    0.1765  1.118 0.2243</span></span>
<span><span class="co">#&gt; 6 0.00000     16    0.0000  1.118 0.2243</span></span></code></pre></div>
<p>The <code>CP</code> column shows the minimum complexity parameter for a tree of the corresponding number of splits. For example if we set the <code>cp</code> value to a number below <code>0.07843</code> and above <code>0.05882</code>, when pruning, the subtree will have 5 splits:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/rpart/man/prune.rpart.html" class="external-link">prune</a></span><span class="op">(</span><span class="va">kmod</span>, cp <span class="op">=</span> <span class="fl">.06</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Pruned with cp = .06"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.svg" width="60%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="how-the-cptable-is-created">How the cptable is created<a class="anchor" aria-label="anchor" href="#how-the-cptable-is-created"></a>
</h2>
<p>To understand how <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart()</a></code> is created we’ll start with some definitions:</p>
<ul>
<li><p>A <em>branch</em> includes an internal node and all of its descendants.</p></li>
<li><p><em>Pruning</em> a branch refers to removing all of the descendants of a node, i.e. collapsing them into the root node of the branch.</p></li>
<li><p>A <em>subtree</em> refers to the original tree after pruning.</p></li>
</ul>
<p>The algorithm for pruning a classification tree begins with calculating the deviance reduction <em>per split</em> for all internal nodes on the large tree. In this context, deviance means misclassified cases, which differs from the tree growing process in which the Gini index, not the number misclassified, is used to determine the next optimal split.</p>
<p>The <code>CP</code> values in the table are a scaled version of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(t)</annotation></semantics></math>, the cost complexity value, which is a direct measure of the misclassification reduction <em>per split</em>. For example, if it takes two splits to reduce the number of misclassified by one, then <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(t)</annotation></semantics></math> would equal <code>0.5</code>. We’ll work in terms of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(t)</annotation></semantics></math> since it’s more intuitive, and return to <code>CP</code> later on.</p>
<p>More formally, for all internal nodes of the tree,</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mrow><mo stretchy="true" form="prefix">|</mo><msub><mover><mi>T</mi><mo accent="true">̃</mo></mover><mi>t</mi></msub><mo stretchy="true" form="postfix">|</mo></mrow><mo>−</mo><mn>1</mn></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">g(t) = \frac{R(t) - R(T_t)}{|\tilde{T}_t| - 1},</annotation></semantics></math> where</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math> is a node in the decision tree,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>t</mi></msub><annotation encoding="application/x-tex">T_t</annotation></semantics></math> is the subtree rooted at node <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>, including <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math> and all of its descendants,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>T</mi><mo accent="true">̃</mo></mover><mi>t</mi></msub><annotation encoding="application/x-tex">\tilde{T}_t</annotation></semantics></math> is the set of terminal (leaf) nodes in the subtree <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>t</mi></msub><annotation encoding="application/x-tex">T_t</annotation></semantics></math>,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">R(t)</annotation></semantics></math> is the risk at node <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>, in this case, the deviance or misclassified cases,</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>T</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">R(T_t)</annotation></semantics></math> is the total risk of the subtree <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>t</mi></msub><annotation encoding="application/x-tex">T_t</annotation></semantics></math>, meaning the sum of risks at all terminal nodes in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>t</mi></msub><annotation encoding="application/x-tex">T_t</annotation></semantics></math>, and</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">|</mo><msub><mover><mi>T</mi><mo accent="true">̃</mo></mover><mi>t</mi></msub><mo stretchy="true" form="postfix">|</mo></mrow><annotation encoding="application/x-tex">|\tilde{T}_t|</annotation></semantics></math> is the number of terminal nodes (leaves) in the subtree <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>t</mi></msub><annotation encoding="application/x-tex">T_t</annotation></semantics></math>,.</p></li>
</ul>
<p>Less formally it’s the misclassification reduction <em>per split</em>, or,</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(t)</annotation></semantics></math> = (the difference between the deviance of node <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math> and the sum of the deviance of node <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>’s leaf descendents) / (number of splits in branch <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>)</p>
<p>For example, let’s consider the branch with root node 22 in the original large tree. We have:</p>
<ul>
<li><p>deviance of branch: 0 (sum of misclassified in leaf nodes)</p></li>
<li><p>deviance of node: 2 (misclassified in node)</p></li>
<li><p>number of splits in branch: 4 (nodes 22, 44, 89, 45)</p></li>
</ul>
<p>Thus <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mn>2</mn><mo>−</mo><mn>0</mn></mrow><mn>4</mn></mfrac><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">g(t) = \frac{2 - 0}{4} = 0.5</annotation></semantics></math></p>
<p>That is, it takes 4 splits to reduce the deviance from 2 to 0, which averages to a 0.5 reduction per split.</p>
<p>The tree below displays <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(t)</annotation></semantics></math> for all branches:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="va">kmod</span>, show_classes <span class="op">=</span> <span class="cn">FALSE</span>, show_gt <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         show_leaf_dev <span class="op">=</span> <span class="cn">TRUE</span>, show_internal_dev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.svg" width="70%" style="display: block; margin: auto;"></p>
<p>By setting <code>show_min</code> to <code>TRUE</code> we can add “*minimum” to the labels for node(s) with the minimum value for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(t)</annotation></semantics></math>. Adding <code>show_pruned</code> changes the color of these nodes and their descendents:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="va">kmod</span>, show_classes <span class="op">=</span> <span class="cn">FALSE</span>, show_gt <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         show_leaf_dev <span class="op">=</span> <span class="cn">TRUE</span>, show_internal_dev <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         show_min <span class="op">=</span> <span class="cn">TRUE</span>, show_pruned <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.svg" width="70%" style="display: block; margin: auto;"></p>
<p>The weakest links have <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">g(t) = 0.5</annotation></semantics></math>.</p>
<p>In <strong>rpart</strong> these are scaled so that the root node has an error of 1, accomplished by dividing all values of <code>g(t)</code> by the deviance of the root node. In this case it is <code>17</code>, so the scaled complexity parameter (henceforth, cp) is <code>0.5/17 = 0.0294</code>. We will redraw the tree with the scaled values by changing <code>show_gt = TRUE</code> to <code>show_cp = TRUE</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="va">kmod</span>, show_classes <span class="op">=</span> <span class="cn">FALSE</span>, show_cp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         show_leaf_dev <span class="op">=</span> <span class="cn">TRUE</span>, show_internal_dev <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         show_min <span class="op">=</span> <span class="cn">TRUE</span>, show_pruned <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.svg" width="70%" style="display: block; margin: auto;"></p>
<p>To save space, henceforth we will only show the scaled values.</p>
<p>To determine the next threshold we need to recalculate <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(t)</annotation></semantics></math> or <code>cp</code>. This is necessary because pruning the tree changes the cost reductions for the remaining nodes. We will set <code>cp</code> to a value slightly above the minimum; we choose <code>.03</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/prune.rpart.html" class="external-link">prune</a></span><span class="op">(</span><span class="va">kmod</span>, cp <span class="op">=</span> <span class="fl">.03</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="va">kmod2</span>, show_classes <span class="op">=</span> <span class="cn">FALSE</span>, show_cp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         show_leaf_dev <span class="op">=</span> <span class="cn">TRUE</span>, show_internal_dev <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         show_min <span class="op">=</span> <span class="cn">TRUE</span>, show_pruned <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.svg" width="70%" style="display: block; margin: auto;"></p>
<p>We continue in this way until the tree is reduced to a single node:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/prune.rpart.html" class="external-link">prune</a></span><span class="op">(</span><span class="va">kmod2</span>, cp <span class="op">=</span> <span class="fl">.06</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="va">kmod3</span>, show_classes <span class="op">=</span> <span class="cn">FALSE</span>, show_cp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         show_leaf_dev <span class="op">=</span> <span class="cn">TRUE</span>, show_internal_dev <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         show_min <span class="op">=</span> <span class="cn">TRUE</span>, show_pruned <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.svg" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmod4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/prune.rpart.html" class="external-link">prune</a></span><span class="op">(</span><span class="va">kmod3</span>, cp <span class="op">=</span> <span class="fl">.08</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="va">kmod4</span>, show_classes <span class="op">=</span> <span class="cn">FALSE</span>, show_cp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         show_leaf_dev <span class="op">=</span> <span class="cn">TRUE</span>, show_internal_dev <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         show_min <span class="op">=</span> <span class="cn">TRUE</span>, show_pruned <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.svg" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmod5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/prune.rpart.html" class="external-link">prune</a></span><span class="op">(</span><span class="va">kmod4</span>, cp <span class="op">=</span> <span class="fl">.12</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="va">kmod5</span>, show_classes <span class="op">=</span> <span class="cn">FALSE</span>, show_cp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         show_leaf_dev <span class="op">=</span> <span class="cn">TRUE</span>, show_internal_dev <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         show_min <span class="op">=</span> <span class="cn">TRUE</span>, show_pruned <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-1.svg" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmod6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/prune.rpart.html" class="external-link">prune</a></span><span class="op">(</span><span class="va">kmod5</span>, cp <span class="op">=</span> <span class="fl">.18</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/annotree.html">annotree</a></span><span class="op">(</span><span class="va">kmod6</span>, show_classes <span class="op">=</span> <span class="cn">TRUE</span>, show_cp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         show_leaf_dev <span class="op">=</span> <span class="cn">TRUE</span>, show_internal_dev <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         show_min <span class="op">=</span> <span class="cn">TRUE</span>, show_pruned <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-1.svg" width="70%" style="display: block; margin: auto;"></p>
<p>Note that the weakest links in the trees above correspond to the values in <code>cptable</code>. We have replicated the process by which the original tree is successively pruned at the new weakest link:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmod</span><span class="op">$</span><span class="va">cptable</span></span>
<span><span class="co">#&gt;        CP nsplit rel error xerror   xstd</span></span>
<span><span class="co">#&gt; 1 0.17647      0    1.0000  1.000 0.2156</span></span>
<span><span class="co">#&gt; 2 0.11765      1    0.8235  1.118 0.2243</span></span>
<span><span class="co">#&gt; 3 0.07843      2    0.7059  1.118 0.2243</span></span>
<span><span class="co">#&gt; 4 0.05882      5    0.4706  1.118 0.2243</span></span>
<span><span class="co">#&gt; 5 0.02941     10    0.1765  1.118 0.2243</span></span>
<span><span class="co">#&gt; 6 0.00000     16    0.0000  1.118 0.2243</span></span></code></pre></div>
<p>Again, the table shows the minimum <code>CP</code> value for a particular number of splits. (Due to rounding in the display, the actual number may be slightly higher.)</p>
<p>The <code>rel error</code> displays the sum of the misclassified cases for a tree of the size indicated <em>divided by</em> the misclassified cases in the root node (<code>nsplit</code> = 0) to ensure that the <code>rel error</code> of a tree with no splits is one.</p>
<p>In this case we have:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>nsplit <span class="op">=</span> <span class="va">kmod</span><span class="op">$</span><span class="va">cptable</span><span class="op">[</span>, <span class="st">"nsplit"</span><span class="op">]</span>,</span>
<span>           misclassified <span class="op">=</span> <span class="fl">17</span><span class="op">*</span><span class="va">kmod</span><span class="op">$</span><span class="va">cptable</span><span class="op">[</span>, <span class="st">"rel error"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   nsplit misclassified</span></span>
<span><span class="co">#&gt; 1      0            17</span></span>
<span><span class="co">#&gt; 2      1            14</span></span>
<span><span class="co">#&gt; 3      2            12</span></span>
<span><span class="co">#&gt; 4      5             8</span></span>
<span><span class="co">#&gt; 5     10             3</span></span>
<span><span class="co">#&gt; 6     16             0</span></span></code></pre></div>
<p>which corresponds to the misclassified cases in the trees shown above.</p>
</div>
<div class="section level2">
<h2 id="choosing-the-cp-value">Choosing the <code>cp</code> value<a class="anchor" aria-label="anchor" href="#choosing-the-cp-value"></a>
</h2>
<p>The <code>xerror</code> and <code>xstd</code> refer to</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/jtr13/annotreer/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/jtr13/annotreer/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing annotreer</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>First Last <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
